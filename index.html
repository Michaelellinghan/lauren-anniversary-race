<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Race Across London! 🚆</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700;900&family=Lobster&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #74b9ff; /* Static background color */
            overflow-x: hidden;
        }

        .font-lobster {
            font-family: 'Lobster', cursive;
        }

        .page {
            display: none;
            animation: fadeIn 0.7s ease-in-out;
        }

        .page.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .btn {
            @apply inline-block px-8 py-4 text-lg font-bold text-white rounded-full shadow-lg transition-transform duration-300 ease-in-out;
            background-color: #e73c7e;
            border: 2px solid white;
        }
        .btn-small {
            @apply px-4 py-2 text-sm;
        }

        .btn:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }
        
        .btn:disabled {
            @apply bg-gray-400 cursor-not-allowed;
            transform: scale(1);
        }

        .info-box {
            @apply bg-white/20 backdrop-blur-sm p-6 rounded-2xl shadow-lg mt-6;
        }

        /* Train Animation */
        #train-transition {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 100;
            display: none;
            justify-content: center;
            align-items: center;
        }

        #train {
            position: absolute;
            left: -200px; /* Start off-screen */
            width: 150px;
            animation: move-train 1.2s ease-in-out forwards;
        }

        @keyframes move-train {
            0% { left: -200px; }
            100% { left: 100vw; } /* Move across the full screen width */
        }

        /* Emergency Stop Button & Modal */
        #emergency-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: #c0392b;
            color: white;
            width: 70px;
            height: 70px;
            border-radius: 50%;
            font-size: 14px;
            text-align: center;
            font-weight: bold;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
            border: 3px solid white;
            z-index: 90;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        #emergency-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 110;
            display: none;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        /* Map Styling */
        .map-container {
            @apply bg-white/80 backdrop-blur-sm p-4 rounded-3xl shadow-2xl my-6 relative;
        }
        .map-path {
            stroke-dasharray: 1000;
            stroke-dashoffset: 1000;
            animation: draw-line 2s ease-in-out forwards 0.5s;
        }
        @keyframes draw-line {
            to {
                stroke-dashoffset: 0;
            }
        }

        @keyframes pulse {
            0% { r: 2; opacity: 1; }
            50% { r: 4; opacity: 0.5; }
            100% { r: 2; opacity: 1; }
        }
        .pulse {
            animation: pulse 1s ease-in-out 3; /* Pulse 3 times */
        }

        #confetti-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 99;
            pointer-events: none;
        }
        
        .fact-box {
            @apply bg-yellow-200/80 backdrop-blur-sm p-4 rounded-2xl text-gray-800 italic mt-4 text-sm;
        }

    </style>
</head>
<body class="text-gray-800">

    <canvas id="confetti-canvas"></canvas>

    <!-- Train Transition Overlay -->
    <div id="train-transition">
        <svg id="train" viewBox="0 0 200 100" xmlns="http://www.w3.org/2000/svg">
            <!-- Jubilee Line Colours -->
            <rect x="10" y="20" width="180" height="60" rx="10" fill="#A0A5A9"/> <!-- Silver -->
            <rect x="10" y="15" width="180" height="10" rx="5" fill="#6A7073"/> <!-- Dark Grey -->
            <rect y="58" width="200" height="10" fill="#6A7073"/> <!-- Dark Grey Stripe -->
            <!-- Windows -->
            <rect x="25" y="30" width="40" height="25" fill="#2c3e50"/>
            <rect x="80" y="30" width="40" height="25" fill="#2c3e50"/>
            <rect x="135" y="30" width="40" height="25" fill="#2c3e50"/>
             <!-- Front light -->
            <circle cx="185" cy="45" r="5" fill="yellow" />
            <!-- Wheels -->
            <circle cx="45" cy="85" r="10" fill="#2c3e50"/>
            <circle cx="155" cy="85" r="10" fill="#2c3e50"/>
        </svg>
    </div>

    <!-- Emergency Stop Modal -->
    <div id="emergency-modal" onclick="hideEmergencyModal()">
        <div class="bg-white p-8 rounded-2xl text-center shadow-lg max-w-sm">
            <h3 class="font-lobster text-3xl text-red-600 mb-4">Emergency Stop!</h3>
            <p id="emergency-message" class="text-lg text-gray-700"></p>
            <button onclick="hideEmergencyModal(event)" class="btn mt-6">Resume Race</button>
        </div>
    </div>

    <!-- Countdown Timer Header -->
    <header class="sticky top-0 left-0 right-0 bg-black/50 backdrop-blur-sm p-2 text-white text-center shadow-lg z-40">
        <div id="countdown" class="flex justify-center items-center space-x-2 md:space-x-4">
            <!-- Countdown will be injected here by JS -->
        </div>
    </header>

    <div class="container mx-auto p-4 md:p-8 max-w-2xl">

        <!-- Page 0: Opening -->
        <div id="page-0" class="page active text-center text-white">
            <h1 class="font-lobster text-5xl md:text-7xl mb-4">Race Across London! 🚆</h1>
            <h2 class="text-2xl md:text-3xl font-bold mb-8">A special 7th anniversary adventure!</h2>
            
            <div class="bg-white/80 backdrop-blur-sm p-8 rounded-3xl shadow-2xl text-gray-700 space-y-4 text-left">
                <p class="text-lg">Welcome to your Race Across London! (Legally different from Race Across the World 😉)</p>
                <p>Lauren, I hope you’re ready for a special anniversary adventure I have prepared for you!</p>
                <p>This is your very own 'Race Across London' – an exciting journey with various checkpoints and questions!</p>
                <p class="text-sm text-center italic text-red-500">P.S. You can press the red 'STOP' button at any time to pause the race timer!</p>
                <hr class="my-6 border-pink-300">
                <h3 class="font-bold text-xl text-pink-500">Pre-Race Challenge:</h3>
                <p>Your first mission is to prepare a suitcase for 4 days and head to 78 Tattershall drive!</p>
                <p>We’ll head to Hemel today, whenever my parents arrive and you are ready. We’ll be staying in London for one night tomorrow, and in Hemel until Sunday.</p>
                <hr class="my-6 border-pink-300">
                <p class="font-bold text-center">The main race starts on <span class="text-pink-500">26th July 2025</span>! Come back then to begin your grand journey!</p>
            </div>

            <button id="start-race-btn" onclick="navigateTo(1)" class="btn mt-8">Start Your London Race</button>
            <p id="start-race-message" class="mt-2 text-white/80"></p>
        </div>

        <!-- Page 1: Stanmore Start -->
        <div id="page-1" class="page text-center text-white">
            <h1 class="font-lobster text-4xl md:text-6xl mb-6">Your Grand Adventure Begins!</h1>
             <div class="map-container">
                <svg id="map-1" viewBox="0 0 100 100" class="w-full h-auto"></svg>
            </div>
            <div class="bg-white/80 backdrop-blur-sm p-8 rounded-3xl shadow-2xl text-gray-700 space-y-4 text-left">
                <h2 class="font-bold text-2xl text-center text-pink-500">Destination: Stanmore Station!</h2>
                <div class="fact-box">
                    <p><strong>Did you know?</strong> Stanmore is the northern terminus of the Jubilee Line!</p>
                </div>
                <p>Welcome to your very own Race Across London Lauren! Your first mission is to get from 78 Tattershall Drive, all the way to Stanmore Train Station in London. Here’s the catch though… No phones allowed, except to view this website! Michael will provide you with a map of London, but you must work out the rest yourself! I hope you remember the way 🤨</p>
                <hr class="my-6 border-pink-300">
                <p class="font-bold text-xl text-center">Your first mission: From 22 Kennedy Drive, NG9 8HT, travel to Stanmore Train Station, HA7 2DX. Travel however you like!</p>
            </div>
            <button onclick="navigateTo(2)" class="btn mt-8">Next Stage</button>
        </div>

        <!-- Page 2: Warwick Avenue Travel -->
        <div id="page-2" class="page text-center text-white">
            <h1 class="font-lobster text-4xl md:text-6xl mb-6">To 'Little Venice'</h1>
             <div class="map-container">
                <svg id="map-2" viewBox="0 0 100 100" class="w-full h-auto"></svg>
            </div>
             <div class="bg-white/80 backdrop-blur-sm p-8 rounded-3xl shadow-2xl text-gray-700 space-y-4 text-left">
                <p>Excellent! You've made it to Stanmore, the gateway to your London adventure. Our first destination takes you to the charming waterways of 'Little Venice'.</p>
                <div class="fact-box">
                    <p><strong>Did you know?</strong> The poet Robert Browning coined the name 'Little Venice' for this area in the 19th century.</p>
                </div>
                <hr class="my-6 border-pink-300">
                <p class="font-bold text-xl text-center">Your task: From Stanmore Station, travel to Warwick Avenue.</p>
            </div>
            <button onclick="navigateTo(3)" class="btn mt-8">I’ve Arrived</button>
        </div>

        <!-- Page 3: Checkpoint 1 -->
        <div id="page-3" class="page text-center text-white">
            <h1 class="font-lobster text-4xl md:text-6xl mb-6">Checkpoint 1</h1>
            <div class="bg-white/80 backdrop-blur-sm p-8 rounded-3xl shadow-2xl text-gray-700 space-y-4 text-left">
                <p>Find a garden-lined street with a name that links to a city in the South West of England. Head along this street until you reach a mini roundabout.</p>
                <hr class="my-6 border-pink-300">
                <h3 class="font-bold text-xl text-center text-pink-500">Question:</h3>
                <p class="text-center">What is on the corner between Formosa Street and Bristol Gardens?</p>
                
                <div class="mt-4 text-center">
                    <input id="answer-1" type="text" class="w-full max-w-sm p-3 rounded-lg border-2 border-pink-300 focus:ring-pink-500 focus:border-pink-500 text-center" placeholder="Your answer here">
                    <p id="feedback-1" class="mt-2 h-6 font-bold"></p>
                    <div id="q1-buttons" class="mt-4 space-x-4 inline-flex">
                        <button onclick="checkAnswer(1)" class="btn">Submit</button>
                        <button onclick="giveUp(1)" class="btn bg-gray-500">Give Up 😔</button>
                    </div>
                    <div id="hint-container-1" class="mt-4">
                        <button onclick="showHint(1)" class="btn btn-small bg-blue-500">Need a hint?</button>
                        <p id="hint-1" class="mt-2 text-black italic" style="display: none;"></p>
                    </div>
                </div>
            </div>
            
            <div id="info-1" class="hidden mt-6 text-left text-white">
                 <div class="info-box">
                    <h3 class="font-bold text-2xl mb-4 text-center">Local Highlights</h3>
                    <h4 class="font-bold text-lg text-pink-100">Coffee & Lunch Stops:</h4>
                    <ul class="list-disc list-inside space-y-2 mt-2">
                        <li><b>Coffee Shop:</b> Cafe Laville is a unique café that sits directly over the canal, offering lovely views.</li>
                        <li><b>Lunch Restaurant:</b> The Waterway is a fantastic gastropub with a large terrace right on the canal.</li>
                    </ul>
                    <h4 class="font-bold text-lg mt-4 text-pink-100">Other Places to Check Out:</h4>
                    <ul class="list-disc list-inside space-y-2 mt-2">
                        <li><b>Rembrandt Gardens:</b> A beautiful and tranquil canalside garden, perfect for a brief, quiet moment.</li>
                        <li><b>Walk the Waterway:</b> How about a 5-10 minute stroll along the canal towpath towards Paddington?</li>
                    </ul>
                    <div id="selfie-prompt-1" class="mt-4 p-4 bg-pink-100 text-pink-800 rounded-lg text-center font-bold" style="display: none;"></div>
                </div>
                <div class="text-center">
                    <button onclick="navigateTo(4)" class="btn mt-8">Next Stage</button>
                </div>
            </div>
        </div>
        
        <!-- Page 4: Leicester Square Travel -->
        <div id="page-4" class="page text-center text-white">
            <h1 class="font-lobster text-4xl md:text-6xl mb-6">Heart of Theatreland</h1>
            <div class="map-container">
                <svg id="map-4" viewBox="0 0 100 100" class="w-full h-auto"></svg>
            </div>
             <div class="bg-white/80 backdrop-blur-sm p-8 rounded-3xl shadow-2xl text-gray-700 space-y-4 text-left">
                <p>Well done! Now, let's head to the heart of Theatreland.</p>
                 <div class="fact-box">
                    <p><strong>Did you know?</strong> Leicester Square was named after Robert Sidney, the 2nd Earl of Leicester, who built a large house there in the 1630s.</p>
                </div>
                <hr class="my-6 border-pink-300">
                <p class="font-bold text-xl text-center">Your task: Travel to Leicester Square.</p>
            </div>
            <button onclick="navigateTo(5)" class="btn mt-8">I’ve Arrived</button>
        </div>

        <!-- Page 5: Checkpoint 2 -->
        <div id="page-5" class="page text-center text-white">
            <h1 class="font-lobster text-4xl md:text-6xl mb-6">Checkpoint 2</h1>
            <div class="bg-white/80 backdrop-blur-sm p-8 rounded-3xl shadow-2xl text-gray-700 space-y-4 text-left">
                <p>Find a famous restaurant located on West Street with ties to one of our children.</p>
                <hr class="my-6 border-pink-300">
                <h3 class="font-bold text-xl text-center text-pink-500">Question:</h3>
                <p class="text-center">What letter is repeated twice on the clock?</p>
                
                <div class="mt-4 text-center">
                    <input id="answer-2" type="text" class="w-full max-w-sm p-3 rounded-lg border-2 border-pink-300 focus:ring-pink-500 focus:border-pink-500 text-center" placeholder="Your answer here">
                    <p id="feedback-2" class="mt-2 h-6 font-bold"></p>
                    <div id="q2-buttons" class="mt-4 space-x-4 inline-flex">
                        <button onclick="checkAnswer(2)" class="btn">Submit</button>
                        <button onclick="giveUp(2)" class="btn bg-gray-500">Give Up 😔</button>
                    </div>
                    <div id="hint-container-2" class="mt-4">
                        <button onclick="showHint(2)" class="btn btn-small bg-blue-500">Need a hint?</button>
                        <p id="hint-2" class="mt-2 text-black italic" style="display: none;"></p>
                    </div>
                </div>
            </div>
            
            <div id="info-2" class="hidden mt-6 text-left text-white">
                 <div class="info-box">
                    <h3 class="font-bold text-2xl mb-4 text-center">Local Highlights</h3>
                    <h4 class="font-bold text-lg text-pink-100">Coffee & Lunch Stops (sorry, we’re not eating here):</h4>
                    <ul class="list-disc list-inside space-y-2 mt-2">
                        <li><b>Coffee Shop:</b> Abuelo is a lovely, relaxed Australian-meets-South American café just around the corner.</li>
                        <li><b>Lunch Restaurant:</b> Dishoom Covent Garden is an incredibly popular spot for delicious Bombay-inspired food.</li>
                    </ul>
                    <h4 class="font-bold text-lg mt-4 text-pink-100">Other Places to Check Out:</h4>
                    <ul class="list-disc list-inside space-y-2 mt-2">
                        <li><b>Neal's Yard:</b> A must-see hidden gem, exploding with colour.</li>
                        <li><b>The London Transport Museum:</b> Given the theme of the race, this is very fitting!</li>
                        <li><b>Covent Garden's Street Performers:</b> Soak up the lively atmosphere.</li>
                        <li><b>Evening Plans:</b> We could come back for 9:05 to see Rachel Zegler on the balcony of the London Palladium!</li>
                    </ul>
                    <div id="selfie-prompt-2" class="mt-4 p-4 bg-pink-100 text-pink-800 rounded-lg text-center font-bold" style="display: none;"></div>
                </div>
                <div class="text-center">
                    <button onclick="navigateTo(6)" class="btn mt-8">Next Stage</button>
                </div>
            </div>
        </div>

        <!-- Page 6: Green Park Travel -->
        <div id="page-6" class="page text-center text-white">
            <h1 class="font-lobster text-4xl md:text-6xl mb-6">A Touch of Grandeur</h1>
            <div class="map-container">
                <svg id="map-6" viewBox="0 0 100 100" class="w-full h-auto"></svg>
            </div>
             <div class="bg-white/80 backdrop-blur-sm p-8 rounded-3xl shadow-2xl text-gray-700 space-y-4 text-left">
                <p>Great job! Now it’s time for a touch of grandeur.</p>
                <div class="fact-box">
                    <p><strong>Did you know?</strong> Green Park is the quietest of the central Royal Parks, with no lakes or buildings and very few formal flowerbeds.</p>
                </div>
                <hr class="my-6 border-pink-300">
                <p class="font-bold text-xl text-center">Your task: Travel to Green Park.</p>
            </div>
            <button onclick="navigateTo(7)" class="btn mt-8">I’ve Arrived</button>
        </div>

        <!-- Page 7: Checkpoint 3 -->
        <div id="page-7" class="page text-center text-white">
            <h1 class="font-lobster text-4xl md:text-6xl mb-6">Checkpoint 3</h1>
            <div class="bg-white/80 backdrop-blur-sm p-8 rounded-3xl shadow-2xl text-gray-700 space-y-4 text-left">
                <p>Find the magnificent private mansion that has been used as a filming location for The Crawley’s London home in Downton Abbey located at 14 Cleveland Road. It overlooks Green Park and is a short walk from here.</p>
                <hr class="my-6 border-pink-300">
                <h3 class="font-bold text-xl text-center text-pink-500">Question:</h3>
                <p class="text-center">What animal is seen above the arch in the doorway?</p>
                
                <div class="mt-4 text-center">
                    <input id="answer-3" type="text" class="w-full max-w-sm p-3 rounded-lg border-2 border-pink-300 focus:ring-pink-500 focus:border-pink-500 text-center" placeholder="Your answer here">
                    <p id="feedback-3" class="mt-2 h-6 font-bold"></p>
                    <div id="q3-buttons" class="mt-4 space-x-4 inline-flex">
                        <button onclick="checkAnswer(3)" class="btn">Submit</button>
                        <button onclick="giveUp(3)" class="btn bg-gray-500">Give Up 😔</button>
                    </div>
                    <div id="hint-container-3" class="mt-4">
                        <button onclick="showHint(3)" class="btn btn-small bg-blue-500">Need a hint?</button>
                        <p id="hint-3" class="mt-2 text-black italic" style="display: none;"></p>
                    </div>
                </div>
            </div>
            
            <div id="info-3" class="hidden mt-6 text-left text-white">
                 <div class="info-box">
                    <h3 class="font-bold text-2xl mb-4 text-center">Local Highlights</h3>
                    <h4 class="font-bold text-lg text-pink-100">Coffee & Lunch Stops:</h4>
                    <ul class="list-disc list-inside space-y-2 mt-2">
                        <li><b>Coffee Shop:</b> Colicci at the entrance to Green Park offers coffee and snacks with a view.</li>
                        <li><b>Lunch Restaurant:</b> The Wolseley on Piccadilly is an elegant European grand café.</li>
                    </ul>
                    <h4 class="font-bold text-lg mt-4 text-pink-100">Other Places to Check Out:</h4>
                    <ul class="list-disc list-inside space-y-2 mt-2">
                        <li><b>A "Fly-by" of Buckingham Palace:</b> We're right on the doorstep!</li>
                        <li><b>Spencer House:</b> Another magnificent aristocratic town house, Princess Diana's ancestral home.</li>
                        <li><b>Fortnum & Mason:</b> A quick walk through this famous luxury department store is an experience in itself.</li>
                    </ul>
                    <div id="selfie-prompt-3" class="mt-4 p-4 bg-pink-100 text-pink-800 rounded-lg text-center font-bold" style="display: none;"></div>
                </div>
                <div class="text-center">
                    <button onclick="navigateTo(8)" class="btn mt-8">Next Stage</button>
                </div>
            </div>
        </div>

        <!-- Page 8: London Bridge Travel -->
        <div id="page-8" class="page text-center text-white">
            <h1 class="font-lobster text-4xl md:text-6xl mb-6">Cross the River</h1>
            <div class="map-container">
                <svg id="map-8" viewBox="0 0 100 100" class="w-full h-auto"></svg>
            </div>
             <div class="bg-white/80 backdrop-blur-sm p-8 rounded-3xl shadow-2xl text-gray-700 space-y-4 text-left">
                <p>Great job! Now it’s time to cross the river.</p>
                 <div class="fact-box">
                    <p><strong>Did you know?</strong> The current London Bridge is only from 1973. Several older bridges have existed at this spot for nearly 2,000 years!</p>
                </div>
                <hr class="my-6 border-pink-300">
                <p class="font-bold text-xl text-center">Your task: Travel to London Bridge.</p>
            </div>
            <button onclick="navigateTo(9)" class="btn mt-8">I’ve Arrived</button>
        </div>

        <!-- Page 9: Checkpoint 4 -->
        <div id="page-9" class="page text-center text-white">
            <h1 class="font-lobster text-4xl md:text-6xl mb-6">Checkpoint 4</h1>
            <div class="bg-white/80 backdrop-blur-sm p-8 rounded-3xl shadow-2xl text-gray-700 space-y-4 text-left">
                <p>Find London's last remaining galleried coaching inn. This historic pub is tucked away on Borough High St near London's most famous food market.</p>
                <hr class="my-6 border-pink-300">
                <h3 class="font-bold text-xl text-center text-pink-500">Question:</h3>
                <p class="text-center">When was this inn established?</p>
                
                <div class="mt-4 text-center">
                    <input id="answer-4" type="text" class="w-full max-w-sm p-3 rounded-lg border-2 border-pink-300 focus:ring-pink-500 focus:border-pink-500 text-center" placeholder="Your answer here">
                    <p id="feedback-4" class="mt-2 h-6 font-bold"></p>
                    <div id="q4-buttons" class="mt-4 space-x-4 inline-flex">
                        <button onclick="checkAnswer(4)" class="btn">Submit</button>
                        <button onclick="giveUp(4)" class="btn bg-gray-500">Give Up 😔</button>
                    </div>
                    <div id="hint-container-4" class="mt-4">
                        <button onclick="showHint(4)" class="btn btn-small bg-blue-500">Need a hint?</button>
                        <p id="hint-4" class="mt-2 text-black italic" style="display: none;"></p>
                    </div>
                </div>
            </div>
            
            <div id="info-4" class="hidden mt-6 text-left text-white">
                 <div class="info-box">
                    <h3 class="font-bold text-2xl mb-4 text-center">Local Highlights</h3>
                    <h4 class="font-bold text-lg text-pink-100">Coffee & Lunch Stops:</h4>
                    <ul class="list-disc list-inside space-y-2 mt-2">
                        <li><b>Coffee Shop:</b> Monmouth Coffee Company in Borough Market is famous for its exceptional coffee.</li>
                        <li><b>Lunch Restaurant:</b> You are spoilt for choice at Borough Market! Or pop in the George Inn!</li>
                    </ul>
                    <h4 class="font-bold text-lg mt-4 text-pink-100">Other Places to Check Out:</h4>
                    <ul class="list-disc list-inside space-y-2 mt-2">
                        <li><b>Southwark Cathedral:</b> This stunning Gothic cathedral is literally next door to Borough Market.</li>
                        <li><b>The Golden Hinde:</b> A beautiful full-size reconstruction of Sir Francis Drake's 16th-century galleon.</li>
                        <li><b>Shakespeare's Globe:</b> A little further along the river bank is the famous Globe theatre.</li>
                    </ul>
                    <div id="selfie-prompt-4" class="mt-4 p-4 bg-pink-100 text-pink-800 rounded-lg text-center font-bold" style="display: none;"></div>
                </div>
                <div class="text-center">
                    <button onclick="navigateTo(10)" class="btn mt-8">Next Stage</button>
                </div>
            </div>
        </div>
        
        <!-- Page 10: Islington Travel -->
        <div id="page-10" class="page text-center text-white">
            <h1 class="font-lobster text-4xl md:text-6xl mb-6">The Final Leg!</h1>
            <div class="map-container">
                <svg id="map-10" viewBox="0 0 100 100" class="w-full h-auto"></svg>
            </div>
             <div class="bg-white/80 backdrop-blur-sm p-8 rounded-3xl shadow-2xl text-gray-700 space-y-4 text-left">
                <p>Perfect. One more destination before we go find our hotel at 72 Prebend Street.</p>
                 <div class="fact-box">
                    <p><strong>Did you know?</strong> Islington has more theatres than any other part of London, including the famous Almeida and Sadler's Wells.</p>
                </div>
                <hr class="my-6 border-pink-300">
                <p class="font-bold text-xl text-center">Your task: Travel to Islington.</p>
            </div>
            <button onclick="navigateTo(11)" class="btn mt-8">I’ve Arrived at the Hotel!</button>
        </div>

        <!-- Page 11: Finish Line -->
        <div id="page-11" class="page text-center text-white">
            <h1 class="font-lobster text-4xl md:text-6xl mb-6">You've Reached the Finish Line!</h1>
            <div class="bg-white/80 backdrop-blur-sm p-8 rounded-3xl shadow-2xl text-gray-700 space-y-4 text-center">
                <p class="text-xl">Congratulations on completing all the checkpoints!</p>
                <p>You're at the final destination for today's race.</p>
                <p class="font-bold mt-4">Ready to stop the clock and see your results?</p>
            </div>
            <button onclick="navigateTo(12)" class="btn mt-8">Finish Today's Race!</button>
        </div>
        
        <!-- Page 12: Race Log -->
        <div id="page-12" class="page text-center text-white">
            <h1 class="font-lobster text-5xl md:text-7xl mb-4">Race Complete!</h1>
            <div class="bg-white/80 backdrop-blur-sm p-8 rounded-3xl shadow-2xl text-gray-700 space-y-6">
                <h2 class="font-bold text-2xl text-center text-pink-500">Your Race Log</h2>
                <div class="text-xl">
                    <p><strong>Checkpoints Completed:</strong> <span id="log-checkpoints"></span>/4</p>
                </div>
                <div class="text-xl">
                    <p><strong>Selfies Taken:</strong> <span id="log-selfies"></span></p>
                </div>
                <div class="text-xl">
                    <p><strong>Souvenirs Collected:</strong> <span id="log-souvenirs" class="text-2xl"></span></p>
                </div>
                <div class="text-xl">
                    <p><strong>Total Race Time:</strong> <span id="log-time"></span></p>
                </div>
                 <div class="text-xl font-bold text-yellow-500">
                    <p>🏆 <strong>Fastest Checkpoint:</strong> <span id="log-fastest"></span></p>
                </div>
                <hr class="my-4 border-pink-300">
                <div class="mt-4 text-center">
                    <h3 class="font-bold text-xl text-pink-500">Photo Finish!</h3>
                    <p class="mb-4">Upload a victory selfie to remember this moment!</p>
                    <label for="photo-upload" class="btn cursor-pointer">Upload Photo 📸</label>
                    <input type="file" id="photo-upload" accept="image/*" class="hidden" onchange="handlePhotoUpload(event)">
                    <img id="photo-finish-img" class="mt-4 rounded-lg shadow-lg max-w-full h-auto mx-auto" style="display: none;">
                </div>
                <hr class="my-4 border-pink-300">
                <p class="text-lg">Well done, Lauren! You've successfully completed your anniversary adventure across London. Time to relax!</p>
                <button onclick="navigateTo(13)" class="btn mt-8">What Now?</button>
            </div>
        </div>
        
        <!-- Page 13: Final Suggestions -->
        <div id="page-13" class="page text-white">
            <h1 class="font-lobster text-4xl md:text-6xl mb-6 text-center">The Adventure Continues...</h1>
            <div class="bg-white/80 backdrop-blur-sm p-8 rounded-3xl shadow-2xl text-gray-700 space-y-4 text-left">
                <p class="text-xl text-center">...tomorrow! But for now, what would you like to do?</p>
                 <div class="info-box text-gray-800">
                    <h3 class="font-bold text-2xl mb-4 text-center text-pink-500">For Coffee (Hyper-Local Gems)</h3>
                    <ul class="list-disc list-inside space-y-2 mt-2">
                        <li><b>Canal No.5:</b> A charming, independent café located directly on the Regent's Canal towpath.</li>
                        <li><b>The Common:</b> A top-quality, minimalist coffee shop focused on expertly made coffee.</li>
                        <li><b>The CoffeeWorks Project:</b> One of the best speciality coffee shops in the area on Camden Passage.</li>
                        <li><b>Kobo Cafe:</b> A lovely, relaxed local favourite on Upper Street.</li>
                    </ul>
                </div>
                 <div class="info-box text-gray-800">
                    <h3 class="font-bold text-2xl mb-4 text-center text-pink-500">For a Celebratory Lunch or Dinner</h3>
                    <ul class="list-disc list-inside space-y-2 mt-2">
                        <li><b>The Duke of Cambridge:</b> Britain's first certified organic pub, practically next door.</li>
                        <li><b>Frederick's:</b> Known for its beautiful conservatory dining room and modern European food.</li>
                        <li><b>The Plaquemine Lock:</b> Serves authentic Louisiana Cajun and Creole food with a brilliant, buzzy atmosphere.</li>
                        <li><b>Trullo:</b> A superb and highly-acclaimed Italian restaurant famous for its hand-made pasta.</li>
                    </ul>
                </div>
                 <div class="info-box text-gray-800">
                    <h3 class="font-bold text-2xl mb-4 text-center text-pink-500">Closer, More Immediate Things To Do</h3>
                    <ul class="list-disc list-inside space-y-2 mt-2">
                        <li><b>Explore Camden Passage:</b> Famous for its antique shops, quirky boutiques, and market stalls.</li>
                        <li><b>A Walk Along the Regent's Canal:</b> We can be on the towpath in under a minute!</li>
                        <li><b>Explore St Peter's Street:</b> Has a wonderful, quiet "village" feel with its Georgian houses.</li>
                        <li><b>Have a Drink at a True Local's Pub:</b> The Wenlock Arms is a famous, award-winning "proper" pub.</li>
                    </ul>
                </div>
                <p class="font-bold text-xl text-center mt-8">Ready for tomorrow? Michael will reveal the plans then.</p>
            </div>
        </div>

    </div>

    <button id="emergency-btn" onclick="showEmergencyModal()">STOP</button>

    <script>
        // --- State Management ---
        let currentPage = 0;
        const pages = document.querySelectorAll('.page');
        const wrongAttempts = { 1: 0, 2: 0, 3: 0, 4: 0 };
        let raceStartTime;
        let checkpointsCompleted = 0;
        let selfiesTaken = 0;
        let raceTimerInterval;
        let isPaused = false;
        let pauseStartTime;
        let questionStartTime;
        const checkpointTimes = {};
        let collectedSouvenirs = [];

        // --- Sound Effects ---
        let soundsReady = false;
        const synth = new Tone.Synth().toDestination();
        const noiseSynth = new Tone.NoiseSynth({
            noise: { type: 'white' },
            envelope: { attack: 0.005, decay: 0.1, sustain: 0 }
        }).toDestination();
        
        document.body.addEventListener('click', async () => {
            if (!soundsReady) {
                await Tone.start();
                soundsReady = true;
            }
        }, { once: true });

        function playSound(type) {
            if (!soundsReady) return;
            if (type === 'correct') {
                synth.triggerAttackRelease("C5", "8n");
            } else if (type === 'wrong') {
                synth.triggerAttackRelease("C3", "8n");
            } else if (type === 'transition') {
                noiseSynth.triggerAttackRelease("0.5");
            }
        }

        // --- Countdown Timer ---
        const countdownDate = new Date("2025-07-26T14:30:00").getTime();

        const countdownFunction = setInterval(() => {
            const now = new Date().getTime();
            const distance = countdownDate - now;

            const days = Math.floor(distance / (1000 * 60 * 60 * 24));
            const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((distance % (1000 * 60)) / 1000);

            const countdownElement = document.getElementById("countdown");
            if (distance < 0) {
                clearInterval(countdownFunction);
                countdownElement.innerHTML = "<div class='font-bold text-lg'>The Race is ON!</div>";
            } else {
                 countdownElement.innerHTML = `
                    <div class='text-center'><div class='text-2xl font-bold'>${days}</div><div class='text-xs'>Days</div></div>
                    <div class='text-2xl font-bold'>:</div>
                    <div class='text-center'><div class='text-2xl font-bold'>${hours}</div><div class='text-xs'>Hours</div></div>
                    <div class='text-2xl font-bold'>:</div>
                    <div class='text-center'><div class='text-2xl font-bold'>${minutes}</div><div class='text-xs'>Mins</div></div>
                    <div class='text-2xl font-bold'>:</div>
                    <div class='text-center'><div class='text-2xl font-bold'>${seconds}</div><div class='text-xs'>Secs</div></div>
                 `;
            }
            
            const startButton = document.getElementById('start-race-btn');
            const startMessage = document.getElementById('start-race-message');
            startButton.disabled = false;
            startMessage.textContent = "Click to preview the race!";

        }, 1000);

        // --- Map Data & Functions ---
        const locations = {
            hemel: { x: 5, y: 5, name: "Hemel" },
            stanmore: { x: 20, y: 20, name: "Stanmore" },
            warwick: { x: 45, y: 50, name: "Warwick Ave" },
            leicester: { x: 65, y: 60, name: "Leic. Sq." },
            greenpark: { x: 55, y: 75, name: "Green Park" },
            londonbridge: { x: 80, y: 70, name: "Lon. Bridge" },
            islington: { x: 75, y: 40, name: "Islington" }
        };

        const londonMapSvg = `
            <path d="M 10 80 Q 50 90, 90 60" stroke="#a2d5f2" stroke-width="4" fill="none" opacity="0.5" />
            <text x="50" y="95" font-size="5" fill="#a2d5f2" text-anchor="middle">River Thames</text>
        `;

        function drawMap(svgId, fromLoc, toLoc) {
            const svg = document.getElementById(svgId);
            svg.innerHTML = londonMapSvg; // Add background map
            
            // Draw all locations
            for (const key in locations) {
                const loc = locations[key];
                const circle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
                circle.setAttribute("id", `loc-${key}-${svgId}`);
                circle.setAttribute("cx", loc.x);
                circle.setAttribute("cy", loc.y);
                circle.setAttribute("r", "2");
                circle.setAttribute("fill", "#6A7073");
                svg.appendChild(circle);

                const text = document.createElementNS("http://www.w3.org/2000/svg", "text");
                text.setAttribute("x", loc.x + 3);
                text.setAttribute("y", loc.y + 1);
                text.setAttribute("font-size", "4");
                text.setAttribute("font-family", "Poppins");
                text.textContent = loc.name;
                svg.appendChild(text);
            }

            // Draw animated path
            if (fromLoc && toLoc) {
                const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
                path.setAttribute("d", `M ${fromLoc.x} ${fromLoc.y} L ${toLoc.x} ${toLoc.y}`);
                path.setAttribute("stroke", "#e73c7e");
                path.setAttribute("stroke-width", "1");
                path.setAttribute("fill", "none");
                path.setAttribute("stroke-linecap", "round");
                path.setAttribute("stroke-dasharray", "2 2");
                path.classList.add("map-path");
                svg.appendChild(path);

                // Animate destination marker
                setTimeout(() => {
                    const toLocKey = Object.keys(locations).find(key => locations[key] === toLoc);
                    document.getElementById(`loc-${toLocKey}-${svgId}`).classList.add('pulse');
                }, 2500); // Start after path animation
            }
        }

        // --- Navigation ---
        function navigateTo(pageIndex) {
            if (pageIndex === 1 && !raceStartTime) {
                raceStartTime = new Date();
                startRaceTimer();
            }

            playSound('transition');
            const trainTransition = document.getElementById('train-transition');
            trainTransition.style.display = 'flex';
            
            const oldTrain = document.getElementById('train');
            const newTrain = oldTrain.cloneNode(true);
            oldTrain.parentNode.replaceChild(newTrain, oldTrain);

            setTimeout(() => {
                pages[currentPage].classList.remove('active');
                currentPage = pageIndex;
                pages[currentPage].classList.add('active');
                window.scrollTo(0, 0);
                trainTransition.style.display = 'none';

                // Handle map drawing
                if (pageIndex === 1) drawMap('map-1', locations.hemel, locations.stanmore);
                if (pageIndex === 2) drawMap('map-2', locations.stanmore, locations.warwick);
                if (pageIndex === 4) drawMap('map-4', locations.warwick, locations.leicester);
                if (pageIndex === 6) drawMap('map-6', locations.leicester, locations.greenpark);
                if (pageIndex === 8) drawMap('map-8', locations.greenpark, locations.londonbridge);
                if (pageIndex === 10) drawMap('map-10', locations.londonbridge, locations.islington);
                
                // Start question timer
                if ([3, 5, 7, 9].includes(pageIndex)) {
                    questionStartTime = new Date();
                }
                
                // Handle Race Log
                if (pageIndex === 12) {
                    clearInterval(raceTimerInterval);
                    document.getElementById('log-checkpoints').textContent = checkpointsCompleted;
                    document.getElementById('log-selfies').textContent = selfiesTaken;
                    document.getElementById('log-souvenirs').textContent = collectedSouvenirs.join(' ');
                    
                    // Calculate fastest checkpoint
                    let fastestTime = Infinity;
                    let fastestCp = null;
                    for (const cp in checkpointTimes) {
                        if (checkpointTimes[cp] < fastestTime) {
                            fastestTime = checkpointTimes[cp];
                            fastestCp = cp;
                        }
                    }
                    const fastestLogEl = document.getElementById('log-fastest');
                    if (fastestCp) {
                        fastestLogEl.textContent = `Checkpoint ${fastestCp} (${(fastestTime / 1000).toFixed(1)}s)`;
                    } else {
                        fastestLogEl.textContent = 'N/A';
                    }

                    launchConfetti();
                }

            }, 1200);
        }

        // --- Quiz Logic ---
        const souvenirs = {
            1: '☎️', 2: '�', 3: '👑', 4: '🍺'
        };

        const answers = {
            1: { accepted: ['a phone box', 'phone box', 'a telephone box', 'telephone box', 'red phone box', 'red telephone box'], reveal: 'A phone box' },
            2: { accepted: ['v'], reveal: 'V' },
            3: { accepted: ['a lion', 'lion'], reveal: 'A Lion' },
            4: { accepted: ['1542'], reveal: '1542' }
        };

        const hints = {
            1: "Think of a classic red box, used for making calls before mobiles existed.",
            2: "This letter is also a Roman numeral.",
            3: "It's known as the 'king of the jungle'.",
            4: "It was established during the reign of King Henry VIII."
        };

        const selfiePrompts = {
            1: "Time for a victory selfie! Pose like you're making a top-secret call in your new-found phone box!",
            2: "Selfie time! Point dramatically at the clock like you've just solved a great mystery.",
            3: "You found it! Quick, a selfie! Look regal and pretend you own the place. Give us your best royal wave!",
            4: "Success! Time for a historical selfie. Pose with your best 'cheers' as if you're a 16th-century traveller enjoying a pint!"
        };

        function checkAnswer(checkpoint) {
            const feedbackEl = document.getElementById(`feedback-${checkpoint}`);
            const inputEl = document.getElementById(`answer-${checkpoint}`);
            const providedAnswer = inputEl.value.trim().toLowerCase();
            
            if (answers[checkpoint].accepted.includes(providedAnswer)) {
                const timeTaken = new Date() - questionStartTime;
                checkpointTimes[checkpoint] = timeTaken;
                playSound('correct');
                feedbackEl.textContent = 'Well done! That\'s correct!';
                feedbackEl.classList.remove('text-red-500');
                feedbackEl.classList.add('text-green-500');
                revealInfo(checkpoint, true);
            } else {
                playSound('wrong');
                wrongAttempts[checkpoint]++;
                feedbackEl.classList.add('text-red-500');
                feedbackEl.classList.remove('text-green-500');
                if (wrongAttempts[checkpoint] >= 3) {
                    feedbackEl.textContent = `Sorry, that's not quite right. The correct answer is: ${answers[checkpoint].reveal}`;
                    revealInfo(checkpoint, false);
                } else {
                    feedbackEl.textContent = 'Not quite, try again!';
                    inputEl.value = '';
                }
            }
        }

        function giveUp(checkpoint) {
            const feedbackEl = document.getElementById(`feedback-${checkpoint}`);
            feedbackEl.textContent = `The correct answer is: ${answers[checkpoint].reveal}`;
            feedbackEl.classList.remove('text-red-500');
            feedbackEl.classList.add('text-blue-500');
            revealInfo(checkpoint, false);
        }

        function revealInfo(checkpoint, isCorrect) {
            document.getElementById(`info-${checkpoint}`).classList.remove('hidden');
            if (isCorrect) {
                checkpointsCompleted++;
                selfiesTaken++;
                collectedSouvenirs.push(souvenirs[checkpoint]);
                const selfieEl = document.getElementById(`selfie-prompt-${checkpoint}`);
                selfieEl.innerHTML = `📸 ${selfiePrompts[checkpoint]}`;
                selfieEl.style.display = 'block';
            }
            
            document.getElementById(`answer-${checkpoint}`).disabled = true;
            document.getElementById(`q${checkpoint}-buttons`).style.display = 'none';
            document.getElementById(`hint-container-${checkpoint}`).style.display = 'none';
        }

        function showHint(checkpoint) {
            const hintEl = document.getElementById(`hint-${checkpoint}`);
            hintEl.textContent = hints[checkpoint];
            hintEl.style.display = 'block';
        }

        // --- Emergency Stop ---
        const emergencyMessages = [
            "Time for an emergency cup of tea and a biscuit!",
            "Detour to the nearest cake shop! Race is paused.",
            "Mandatory 5-minute sightseeing break has been activated!",
            "Quick, hide! A ticket inspector is coming! (Just kidding, timer paused.)"
        ];

        function showEmergencyModal() {
            if (raceTimerInterval) {
                isPaused = true;
                pauseStartTime = new Date();
                clearInterval(raceTimerInterval);
            }
            const messageEl = document.getElementById('emergency-message');
            messageEl.textContent = emergencyMessages[Math.floor(Math.random() * emergencyMessages.length)];
            document.getElementById('emergency-modal').style.display = 'flex';
        }
        function hideEmergencyModal(event) {
            event.stopPropagation();
            if (raceStartTime && isPaused) {
                const pausedDuration = new Date() - pauseStartTime;
                raceStartTime = new Date(raceStartTime.getTime() + pausedDuration);
                startRaceTimer();
                isPaused = false;
            }
            document.getElementById('emergency-modal').style.display = 'none';
        }


        // --- Race Timer ---
        function startRaceTimer() {
            const timeLogEl = document.getElementById('log-time');
            raceTimerInterval = setInterval(() => {
                if (!isPaused) {
                    const now = new Date();
                    const diff = now - raceStartTime;
                    const hours = Math.floor(diff / 3600000);
                    const minutes = Math.floor((diff % 3600000) / 60000);
                    const seconds = Math.floor((diff % 60000) / 1000);
                    timeLogEl.textContent = `${hours}h ${minutes}m ${seconds}s`;
                }
            }, 1000);
        }
        
        // --- Photo Finish ---
        function handlePhotoUpload(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const imgEl = document.getElementById('photo-finish-img');
                    imgEl.src = e.target.result;
                    imgEl.style.display = 'block';
                };
                reader.readAsDataURL(file);
            }
        }

        // --- Confetti ---
        const confettiCanvas = document.getElementById('confetti-canvas');
        const confettiCtx = confettiCanvas.getContext('2d');
        let confettiParticles = [];
        const confettiCount = 200;
        const colors = ['#e73c7e', '#23a6d5', '#23d5ab', '#ee7752', '#feca57'];

        function launchConfetti() {
            confettiCanvas.width = window.innerWidth;
            confettiCanvas.height = window.innerHeight;
            confettiParticles = [];
            for (let i = 0; i < confettiCount; i++) {
                confettiParticles.push({
                    x: Math.random() * confettiCanvas.width,
                    y: -20,
                    w: Math.random() * 10 + 5,
                    h: Math.random() * 10 + 5,
                    color: colors[Math.floor(Math.random() * colors.length)],
                    speed: Math.random() * 3 + 2,
                    tilt: Math.random() * 10 - 5,
                    tiltAngle: 0
                });
            }
            animateConfetti();
        }

        function animateConfetti() {
            confettiCtx.clearRect(0, 0, confettiCanvas.width, confettiCanvas.height);
            confettiParticles.forEach((p, i) => {
                p.y += p.speed;
                p.tiltAngle += 0.1;
                p.x += Math.sin(p.tiltAngle) * 2;
                confettiCtx.fillStyle = p.color;
                confettiCtx.save();
                confettiCtx.translate(p.x + p.w / 2, p.y + p.h / 2);
                confettiCtx.rotate(p.tiltAngle);
                confettiCtx.fillRect(-p.w / 2, -p.h / 2, p.w, p.h);
                confettiCtx.restore();

                if (p.y > confettiCanvas.height) {
                    confettiParticles.splice(i, 1);
                }
            });
            if (confettiParticles.length > 0) {
                requestAnimationFrame(animateConfetti);
            }
        }

        // Initialize first page
        document.addEventListener('DOMContentLoaded', () => {
             pages[0].classList.add('active');
        });
    </script>

</body>
</html>
�
